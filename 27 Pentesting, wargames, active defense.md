- CySA+ is not a pentesting exam
- You don't need to have deep knowledge of pentesting
- Understand differences between pentesting and other ways of detecting vulnerabilities

### Threat hunting vs pentesting

##### Threat hunting
- Less disruptive, more of a "look but don't touch" approach
- Largely passive
- Based on observation and analysis
- Shortens detection times for threats

##### Pentesting
- Starts with passive recon, but continues on to active methodologies
- Find vulnerabilities and attempt to exploit them - in an authorized and controlled fashion
- Thus we prove that vulnerabilities exist and report on them to the leadership
- Disruptive and noisy process - you might break something!
- Provides a look at our org's security posture from the attacker's PoV

- Both processes pursue the same goal - proactive defense
- Pentesting simply takes it a step further and confirms thru action that discovered vulnerabilities can be exploited
- Everything can be tested: employees (via social engineering), physical access, hosts, network, cloud, security policies
- Find out where we lack defenses, patch those holes, level up the security posture
- Show customers that we have well-developed ways of dealing with threats and attacks
- Helps with compliance - sometimes required for compliance (e.g. PCI DSS)

### What's so special about pentesting?

- We're just looking for vulnerabilities, right?
- The entire approach is actually different, from the very start
- **Rules of Engagement**: the crucial first step in any pentest ordered by an org
	- Must be completed and presented before the first command is typed into the terminal
	- Authorization MUST be provided - otherwise what you're doing is simply illegal
		- If cloud resources are involved, we can't just get authorization from the company, but we also need to make sure all is kosher on the cloud provider's side of things
	- What is the scope of the pentest? Establishing limits and thresholds
		- What can we attack? What can't we attack?
		- This must be described in exhaustive detail! Network segments, IP address ranges, etc.
		- Which techniques are allowed and which ones are not? E.g. do we perform social engineering? What are the tools we can't use? How aggressive is the approach?
		- Don't give in to "scope creep" - letting the scope grow in an uncontrolled manner. The risk is damaging normal business operations
		- What are the laws? Federal, state, county, town, etc. Pentesting is not legal everywhere, in some places it's a gray area.
		- What aspects of the infrastructure do we attack? Web, WLAN, physical, mobile, etc. 
		- Black box? Gray box? White box? Former represents an outside attacker, latter is more of an insider threat PoV
		- Do we try to exfiltrate data? If so, make sure it's not live company data
		- Do we engage the staff in any way? Are we allowed to break into the company by exploiting a human vulnerability? 
	- Time aspect: when does the pentest start? What part of the day? How long does it go for?
- **Reporting** - a vital part. What are the lessons learned, what's the end result? 
	- List all findings and conclusions drawn from them
	- List things that allowed you to attack other things
	- Remediation proposals if requested

### Wargames

- Involve some members of your org, perform a team-based exercise
- Split them into teams with specific responsibilities and specific roles
	- Red team, sometimes referred to as the "tiger team": the attackers trying to compromise the target and test the org's security posture
	- Blue team: defenders, analysts, incident responders
	- White team: the arbiters. They control the game, make sure everything goes by the rules, decide who the winner is
	- Purple team: can have red- and blue-team duties, but in wargames its purpose is to ensure communication between the two opposing groups and to collect and record findings from both teams
		- In the end, both teams' goals are the same: improving the company's security posture
- Always have a well-described scope and a scenario
- To make it more realistic, the red team should use a black-box approach and the blue team won't know what's about to be attacked
- In the end, both teams' end goal is the same: finding vulnerabilities in the infrastructure that haven't yet been patched

### Active defense

- This is about throwing a wrench into an attacker's activities, making them waste time and resources, proving our company to be too difficult to hack, and forcing them to give up and look elsewhere
- Decoy tactics aimed at throwing attackers off and making their lives as difficult as possible
	- Non-standard port numbers
	- Non-standard user accounts
	- Obfuscation
	- Bogus DNS entries that can only be found as a result of a scan and will lead nowhere
- Honeypot: an exposed server that's meant to be attacked, used as a bait
	- Nothing valuable runs there
	- Attacker gets in there and is monitored, their TTPs studied, their time wasted
	- Another purpose of a honeypot is that it's an early warning system. We can gather info about a potential attacker as soon as they start interacting with the honeypot, so use that info and start monitoring right away! 
	- [OpenCanary](https://opencanary.readthedocs.io/en/latest/) - open-source honeypot software, very customizable, aimed at making a honeypot look as real as possible
	- Don't make your honeypots too tempting or too easy to pwn - they might end up looking like honeypots
- Honeynet: a network segment that acts like a legitimate network segment but is bait also
- Annoyance tactics
	- Open random ports that do nothing and slow them down
	- Create intentional slow response from some apps - against brute force
	- Generate intentionally misleading error messages, e.g. telling the attacker the username is correct but the password is wrong (when in fact both are wrong)
- Counter attacks - trolling the hacker
	- Comes with a lot of legal and reputational responsibility
	- "Should we be doing this?"

### Blocklisting vs whitelisting

##### Blacklist/blocklist approach
- Blacklisting and blocklisting are interchangeable terms
- Specifying what is NOT allowed (destinations to access, operations to perform, apps to install, etc.)
- Everything else is therefore allowed
- Can be used during incident response - blocking the source of malicious traffic during an attack, blocking the C2 domain, etc.; blocking specific ports that are used by malware as long as it's relevant to our org's operations 
- Using this approach on the daily basis can be tricky - it is reactive by definition
- Be careful with excessive blocking - it can interfere with legitimate traffic
- Be careful with too little blocking also
- We can never know about everything that might hurt us, therefore it's impossible to have a blocklist against everything

##### Whitelist approach
- Specifying what IS allowed
- Everything else is therefore denied
- Requires knowing exactly what our environment looks like, what applications are in use and what needs to be accessible for proper business operation
- Can also be used during incident response - limiting the interaction with the interwebs to a bare minimum, which will likely block malicious traffic since we don't have to identify it; it's also much faster
- Requires a lot more admin work - there will always be users who can't access something, but need to access it ASAP
	- Too many such requests may create issues on the inside when you start allowing too much due to fatigue
	- There's a risk that apps/resources required for work may not end up on the whitelist

##### Execution control
- Mostly implemented as part of endpoint security solutions
- Monitor, then allow/deny installation and execution of software
- Has to rely on some kind of policy or baseline and configured for each type of host
- Can be implemented in either a whitelist or a blocklist approach
- Requires an agent integrated with the OS
- Examples:
	- [Software Restriction Policies (Microsoft)](https://learn.microsoft.com/en-us/windows-server/identity/software-restriction-policies/software-restriction-policies) - based on group policy (AD environment), runs on workstations in a domain, identifies software that runs and can restrict specifics types of apps
	- [AppLocker (Microsoft)](https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/applocker-overview) - applies on the client side, improves on SRP
	- [Windows Defender Application Control](https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/applocker-overview) - aimed at end-user workstations, allows us to set policies that specify whether a driver or an app is trusted 
	- [AppArmor (Linux)](https://wiki.ubuntu.com/AppArmor) - mandatory access control on Linux, specify exactly who can do what on a system
	- [SELinux (Security Enhanced Linux)](https://selinuxproject.org/page/Main_Page) - offers security policies enforced by the system, not by the user profile
- Mobile devices can also be subjected to execution control - UEM (Unified Endpoint Management) solutions can restrict apps that can be installed, all the way to creating an internal app store for the company and only allowing apps from there

---

### Exam

Be able to discuss pentesting and how it differs from threat hunting. Know what's involved in wargames, know the types of teams; be familiar with active defense (especially decoy tactics, honeypots, and honeynets) techniques; know the difference between whitelisting and blocklisting and what execution control is, provide examples of it for Windows and Linux